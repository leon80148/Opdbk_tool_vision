# 🚀 安家診所掛號助手 - 首次安裝說明

## 📦 安裝步驟

1. **執行安裝檔**：`安家診所掛號助手 Setup 0.9.0.exe`
2. **授予管理員權限**（會彈出 UAC 提示）
3. **選擇安裝位置**（預設：`C:\Users\{使用者名稱}\AppData\Local\Programs\安家診所掛號助手\`）
4. **等待安裝完成**

> 💡 **建議安裝位置**：為避免權限問題，建議安裝到預設的使用者目錄，或選擇 `C:\AnchiaOPD\` 等非系統保護目錄

---

## 📁 安裝後的目錄結構

**預設位置**：`C:\Users\{使用者名稱}\AppData\Local\Programs\安家診所掛號助手\`

**或您選擇的自訂位置**（建議：`C:\AnchiaOPD\`）

```
{安裝目錄}\
├── 安家診所掛號助手.exe          ← 主程式
├── config.ini                     ← 設定檔（首次啟動自動建立）
├── data\                          ← 資料庫目錄（自動建立）
│   └── lab_cache.db              ← SQLite 快取資料庫
├── logs\                          ← 日誌目錄（自動建立）
│   ├── app.log                   ← 應用程式日誌
│   └── error.log                 ← 錯誤日誌
└── resources\                     ← 應用程式資源
    ├── app.asar
    ├── config.ini.example        ← 設定檔範例
    └── config\
        ├── lab_codes.json        ← 檢驗代碼對應表
        └── rules.json            ← 規則定義
```

**特色**：所有檔案都在安裝目錄下，備份時直接複製整個資料夾即可！

---

## ⚙️ 首次設定（重要！）

### 1. 啟動應用程式

首次啟動時，程式會自動從 `config.ini.example` 建立 `config.ini`

### 2. 修改 config.ini（必須！）

**找到設定檔**：

前往安裝目錄，用記事本開啟 `config.ini`

預設位置：`C:\Users\{使用者名稱}\AppData\Local\Programs\安家診所掛號助手\config.ini`

**修改診所名稱**：

找到以下內容：

```ini
[clinic]
# ⚠️ 請修改為您的診所名稱
name = 安家診所掛號助手
```

**改成您診所的名稱**，例如：
- `name = 仁愛診所掛號助手`
- `name = 健康家庭醫學診所`

**修改 HIS 資料庫路徑**：

找到以下內容：

```ini
[database]
# ⚠️ 請修改為您的實際 HIS 資料庫路徑
dbf_root = D:\\HIS\\DBF\\
```

**改成您診所的實際路徑**，例如：
- `D:\\醫療系統\\資料\\` （本機路徑）
- `\\\\192.168.1.100\\HIS\\DBF\\` （網路磁碟 UNC 路徑）
- `Z:\\DBF\\` （映射的網路磁碟）

> ⚠️ **注意**：Windows 路徑需使用雙反斜線 `\\` 或單斜線 `/`

**其他設定使用預設值即可**：

```ini
[database]
# SQLite 資料庫（預設在安裝目錄下，不需修改）
sqlite_path = .\\data\\lab_cache.db

# 預載入歷史資料年數（3年約150-200MB記憶體）
preload_years_back = 3

[hotkey]
# 縮放視窗熱鍵
global = Ctrl+1

# 查詢熱鍵（自動抓取剪貼簿）
capture = Ctrl+2

[logging]
# 日誌檔案（預設在安裝目錄下，不需修改）
log_file = .\\logs\\app.log
```

### 3. 重啟應用程式

修改完成後，關閉並重新啟動應用程式

---

## 🎯 快速找到設定檔的方法

### 方法 1：從開始選單

1. 在開始選單找到「安家診所掛號助手」
2. 右鍵點擊 → 選擇「開啟檔案位置」
3. 就會看到 `config.ini`

### 方法 2：直接前往

預設安裝位置：
```
C:\Users\{使用者名稱}\AppData\Local\Programs\安家診所掛號助手\config.ini
```

或按 `Win + R`，輸入：
```
%LOCALAPPDATA%\Programs\安家診所掛號助手
```

---

## 🔧 常見設定調整

### 調整預載入資料年數（減少記憶體占用）

如果記憶體不足，可以減少預載入年數：

```ini
[database]
# 改成 1 或 2 年，記憶體占用會降到 50-100MB
preload_years_back = 1
```

### 修改熱鍵組合

如果熱鍵衝突，可以改成其他組合：

```ini
[hotkey]
# 縮放視窗熱鍵（預設：Ctrl+1）
global = Ctrl+Shift+A

# 查詢熱鍵（預設：Ctrl+2）
capture = Ctrl+Shift+Q
```

或在應用程式的**設定介面**中直接修改（更方便）

### 調整視窗大小和位置

```ini
[ui]
# 視窗大小
window_width = 1400
window_height = 900

# 視窗位置（留空則自動置中）
window_x = 100
window_y = 50

# 啟動時最大化
start_maximized = true
```

---

## ❌ 疑難排解

### 問題 1：啟動時找不到 DBF 資料庫

**症狀**：啟動時顯示警告「DBF root directory not found」

**解決方法**：
1. 檢查 `config.ini` 中的 `dbf_root` 路徑是否正確
2. 確認 HIS 資料庫路徑存在
3. 確認路徑使用雙反斜線 `\\` 或單斜線 `/`
4. 確認路徑下有 CO01M.DBF、CO02M.DBF 等檔案

### 問題 2：熱鍵沒有反應

**症狀**：按下 `Ctrl+1` 沒有反應

**可能原因**：
1. 其他程式占用了相同的熱鍵組合
2. 權限不足（需要以管理員身分執行）

**解決方法**：
1. 修改 `config.ini` 中的熱鍵組合
2. 右鍵點擊主程式 → 選擇「以系統管理員身分執行」
3. 或在應用程式設定介面中修改熱鍵

### 問題 3：記憶體占用過高

**症狀**：應用程式占用 500MB 以上記憶體

**解決方法**：
1. 減少 `preload_years_back`（改為 1 或 2）
2. 重啟應用程式

### 問題 4：找不到 config.ini

**症狀**：安裝目錄下沒有 `config.ini`

**解決方法**：
1. 確認至少啟動過一次應用程式
2. 手動從 `resources\config.ini.example` 複製一份到安裝目錄
3. 重新命名為 `config.ini`

### 問題 5：無法啟動或出現錯誤

**症狀**：點擊主程式後沒有反應或出現錯誤訊息

**解決方法**：
1. 查看 `logs\error.log` 檔案
2. 確認是否有缺少相依套件（如 VC++ Redistributable）
3. 以系統管理員身分執行
4. 重新安裝應用程式

### 問題 6：無法創建 logs 或 data 目錄（權限錯誤）

**症狀**：啟動時出現「EPERM: operation not permitted, mkdir」錯誤

**原因**：安裝到 Program Files 等系統保護目錄，應用程式無權限創建檔案

**解決方法**：
1. **重新安裝**到建議的位置：
   - 使用預設安裝位置（`%LOCALAPPDATA%\Programs\安家診所掛號助手\`）
   - 或安裝到 `C:\AnchiaOPD\` 等非系統保護目錄
2. **或**右鍵點擊主程式 → 選擇「以系統管理員身分執行」（每次都需要）

---

## 📝 查看日誌

如果遇到問題，可以查看日誌檔案：

**預設位置**：
```
C:\Users\{使用者名稱}\AppData\Local\Programs\安家診所掛號助手\logs\app.log
C:\Users\{使用者名稱}\AppData\Local\Programs\安家診所掛號助手\logs\error.log
```

**快速開啟**：按 `Win + R`，輸入 `%LOCALAPPDATA%\Programs\安家診所掛號助手\logs`

---

## 💡 使用技巧

### 快速查詢病患

1. **方法 1**：在搜尋框輸入病歷號（會自動補零為 7 位數）
2. **方法 2**：複製病歷號或身分證號 → 按 `Ctrl+2`（自動查詢）

### 視窗快速切換

- 按 `Ctrl+1` 可以快速顯示/隱藏視窗
- 配合 `Ctrl+2` 可以一鍵查詢剪貼簿中的病患

### 備份設定和資料

**超簡單備份**：直接複製整個安裝目錄！

**預設位置**：
```
C:\Users\{使用者名稱}\AppData\Local\Programs\安家診所掛號助手\
```

**快速開啟**：按 `Win + R`，輸入 `%LOCALAPPDATA%\Programs\安家診所掛號助手`

**備份內容**：
- ✅ 設定檔（config.ini）
- ✅ 快取資料庫（data\lab_cache.db）
- ✅ 日誌檔案（logs\）

可直接複製到其他電腦使用（綠色軟體特性）

---

## 🚀 進階功能

### 視窗位置記憶

應用程式會自動記住視窗位置和大小，下次啟動時會自動恢復

### 自動查詢

在 HIS 系統中複製病歷號或身分證號後，按 `Ctrl+2` 即可自動查詢，無需手動輸入

### 預防保健判斷

自動顯示病患是否符合以下項目：
- 成人健檢一階/二階
- 大腸癌篩檢
- 口腔癌篩檢
- 流感疫苗
- 新冠疫苗
- 肺鏈疫苗

### 慢性病管理

自動顯示：
- 糖尿病管理（最近一次 HbA1c）
- 腎臟病管理（最近一次 eGFR）
- 代謝症候群管理（最近一次 HDL、TG）

---

## 📞 需要協助？

如果遇到無法解決的問題：

1. 查看 `logs\error.log` 檔案
2. 參閱 [USER_MANUAL.md](./USER_MANUAL.md) 完整使用手冊
3. 聯絡系統管理員
4. 提供錯誤日誌協助除錯

---

**版本**：v0.9.0
**更新日期**：2025-11-23
**安裝檔位置**：`dist\安家診所掛號助手 Setup 0.9.0.exe`
